<div class="container-fluid">
  <div class="row">
    <div [ngClass]="memberId ? 'col-sm-6' : 'col-sm-12'" >
      <mat-form-field appearance="outline">
        <mat-label>Select Member</mat-label>
        <mat-select [(ngModel)]="memberId" (selectionChange)="setMember($event.value)">
          <app-mat-select-search [(ngModel)]="searchMembers"></app-mat-select-search>
          <mat-option *ngFor="let member of members | search:'name':searchMembers" [value]="member.id">
            {{member.name}} ({{member.phone_number}})
          </mat-option>
        </mat-select>
      </mat-form-field>
    </div>
    <div class="col-sm-6" *ngIf="memberId" @fadeIn>
      <mat-form-field appearance="outline">
        <mat-label>Loan Type</mat-label>
        <mat-select [(ngModel)]="loanTypeId" (selectionChange)="setLoanType($event.value)">
          <mat-option *ngFor="let member of loanTypes" [value]="member.id">
            {{member.name}}
          </mat-option>
        </mat-select>
      </mat-form-field>
    </div>
    <div class="col-sm-6" *ngIf="loanTypeId" @fadeIn>
      <mat-form-field appearance="outline">
        <mat-label>Loan Start Date</mat-label>
        <input (dateChange)="setEndDate()" readonly matInput [matDatepicker]="startingDate" [(ngModel)]="contributionDate"/>
        <mat-datepicker-toggle matSuffix [for]="startingDate"></mat-datepicker-toggle>
        <mat-datepicker #startingDate></mat-datepicker>
      </mat-form-field>
    </div>
    <div class="col-sm-6" *ngIf="contributionDate">
      <mat-form-field appearance="outline">
        <mat-label>Amount Loaned <span *ngIf="loanAmount">({{loanAmount | number}})</span> </mat-label>
        <input type="number" (input)="calculateLoan()" matInput [(ngModel)]="loanAmount" placeholder="Amount Loaned">
      </mat-form-field>
    </div>
    <div class="col-sm-6" *ngIf="loanAmount">
      <mat-form-field appearance="outline">
        <mat-label>Loan duration ({{duration}} {{durationTYpe}})</mat-label>
        <input type="number" (input)="calculateLoan()" matInput [(ngModel)]="duration" placeholder="Loan Duration in {{durationTYpe}}">
      </mat-form-field>
    </div>
    <div class="col-sm-6" *ngIf="duration" @fadeIn>
      <mat-form-field appearance="outline">
        <mat-label>Loan End Date</mat-label>
        <input readonly matInput [matDatepicker]="endingDate" [(ngModel)]="endDate"/>
        <mat-datepicker-toggle matSuffix [for]="endingDate"></mat-datepicker-toggle>
        <mat-datepicker #endingDate></mat-datepicker>
      </mat-form-field>
    </div>
    <div class="col-sm-6" *ngIf="duration">
        <mat-form-field appearance="outline">
          <mat-label>Amount to return <span *ngIf="returnAmount">({{returnAmount | number}})</span></mat-label>
          <input type="number" matInput [(ngModel)]="returnAmount" placeholder="Amount to return">
        </mat-form-field>
    </div>
    <div class="col-sm-6" *ngIf="returnAmount">
        <mat-form-field appearance="outline">
          <mat-label>Amount returned to date <span *ngIf="returnedAmount">({{returnedAmount | number}})</span></mat-label>
          <input (input)="setReturnedAmount($event)" type="number" matInput [(ngModel)]="returnedAmount" placeholder="Amount returned to date">
        </mat-form-field>
    </div>
    <div class="col-sm-6" *ngIf="currentLoanType && currentLoanType.is_insured">
        <mat-form-field appearance="outline">
          <mat-label>Insurance Amount <span *ngIf="insuranceAmount">({{insuranceAmount | number}})</span></mat-label>
          <input type="number" matInput [(ngModel)]="insuranceAmount" placeholder="Amount returned to date">
        </mat-form-field>
    </div>
    <div class="col-sm-6" *ngIf="returnedAmount">
        <mat-form-field appearance="outline">
          <mat-label>Remaining Amount <span *ngIf="remainingBalance">({{remainingBalance | number}})</span></mat-label>
          <input type="number" matInput [(ngModel)]="remainingBalance" placeholder="Amount Remained">
        </mat-form-field>
    </div>

    <div class="col-sm-6" *ngIf="returnedAmount" @fadeIn>
      <mat-form-field appearance="outline">
        <mat-label>Last return Date</mat-label>
        <input readonly matInput [matDatepicker]="lastDate" [(ngModel)]="lastReturnDate"/>
        <mat-datepicker-toggle matSuffix [for]="lastDate"></mat-datepicker-toggle>
        <mat-datepicker #lastDate></mat-datepicker>
      </mat-form-field>
    </div>

    <div class="col-sm-12 mt-3" *ngIf="lastReturnDate" @fadeIn>
      <app-save-area
        [confirmFirst]="true"
        confirmText="Are you sure you want to ADD loan as contribution to {{currentMember.name}}?"
        [saveDisabled]="!lastReturnDate"
        (cancel)="onClose()"
        (save)="save()"
        [savingData]="loading"
      ></app-save-area>
    </div>
  </div>
</div>
